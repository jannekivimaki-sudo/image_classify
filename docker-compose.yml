version: '3.8'

services:
  image-classifier:
    build: .
    ports:
      - "5000:5000"
    volumes:
      - ./data/source:/data/source
      - ./data/classified:/data/classified
      - ./data/static:/data/static
    environment:
      - FLASK_ENV=development
      - LINK_MODE=symlink   # vaihtoehdot: symlink, hardlink, copy
    restart: unless-stopped

  # SFTP-palvelin, johon kamera voi lähettää kuvia.
  # Luodaan käyttäjä 'camera' salasanalla 'password' (vaihda tuotannossa)
  sftp:
    image: atmoz/sftp:latest
    ports:
      - "2222:22"
    volumes:
      - ./data/source:/home/camera/upload
    command: camera:password:1001
    restart: unless-stopped

volumes:
  source_images:
  classified_images:
